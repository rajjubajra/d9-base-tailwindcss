<div class="container mx-auto px-4">

  <header role="banner">
    {{ page.header }}
  </header>

  {{ page.primary_menu }}
  {{ page.secondary_menu }}

  
  <main role="main">
    <div class="w-full min-h-screen">
      <h1 class="text-2xl">Account Statement</h1>
      <div id="view-statement"></div>
    </div>
    


  </main>

  {% if page.footer %}
    <footer role="contentinfo">
      {{ page.footer }}
    </footer>
  {% endif %}

</div>{# /.layout-container #}



<script>

  window.onload = function(){
    try{
        getInvoices();
    }catch(err){
      console.log("Error: URL parameter not found or", err );
    }
  }

 
  const getInvoices = async (uuid) => {

    /** FETCH - INVOICE NUMBER AND DATE **/  
    const urlInv = `/d9-base/jsonapi/node/invoice`;

    const response_invoice = await fetch(urlInv, {
      method: "GET",
      headers:{
        Accept: 'application/vnd.api+json'
      }
    });
    const invoices = await response_invoice.json();
    console.log(invoices.data);
    

    const newArr = [];
    console.log("new Arr", newArr);
    invoices.data.forEach(async (invoice) => {
      const {attributes:{field_old_invoice_number, field_invoice_date}} = invoice;
      const {relationships:{field_invoice_details:{links:{related}}}} = invoice;

      newArr.push({num: field_old_invoice_number, date: field_invoice_date});
      

      const response_details = await fetch(related.href,{
        method: "GET",
        headers: {
          Accept: 'application/vnd.api+json'
        }
      });
      const details = await response_details.json();

      console.log(details);
      details.data.forEach((item)=>{
        const {attributes:{field_description:{value}, field_quantity, field_rate}} = item;
        statementArr.push({date:field_invoice_date, num: field_old_invoice_number, desc: value});
      })

    })
    
    const statementArr = [];
    console.log("STATEMENT ARR",statementArr);


    const CreateStatementArr = (arr, num, date) => {
        console.log(arr, num, date);
        
        arr.data.forEach((item)=>{
          const {attributes:{field_description:{value}, field_quantity, field_rate}} = item
          statementArr.push({date: data, inv_num: num, desc: value, qty: field_quantity, rate: field_rate})
        });
        
    }
  }
  
  


  </script>



